library(e1071)
library(ggplot2)
options(digits=15)
args<-commandArgs(T)
#first args is the svm_input_D and the seconde is the svm_input_I
data<-read.table(args[1],sep="\t",header=T,stringsAsFactors = TRUE)
#cost and gramma parameter were obtained from SVMtune.R
#svm_tune<-tune.svm(label~.,data=data,type="C-classification",kernel="radial",cost=c(0.1,1,5,10),gamma=c(0.5,1,2,3,4),scale=FALSE,probability=TRUE)
#summary(svm_tune)
#svm_model_after_tune<-svm_tune$best.model
svm_model_after_tune<-svm(label ~ ., data=data, type="C-classification", kernel="radial", cost=20, gamma=3, scale=FALSE,probability=TRUE)
temp<-paste(args[3],"svm_D_performance.pdf",sep ="_")
#pdf(temp)
#plot(svm_model_after_tune, data, Percent~Zscore)
grid <- expand.grid(seq(min(data[, 1]), max(data[, 1]),length.out=length(unique(data[,1]))), seq(min(data[, 2]), max(data[, 2]),length.out=length(unique(data[,1]))))
names(grid) <- names(data)[1:2]
preds <- predict(svm_model_after_tune, grid)
df <- data.frame(grid, preds)
#dev.off()
temp<-paste(args[3],"svm_line_D.txt",sep ="_")
write.table(df,temp,sep="\t")
temp<-paste(args[3],"svm_line_D.pdf",sep ="_")
#pdf(temp)
#ggplot(df, aes(x = Zscore, y = Percent)) + geom_tile(aes(fill=preds))+geom_jitter(data = data, aes(x=Zscore, y=Percent,colour=label), size = 0.2)+scale_colour_manual(values=c("#80cdc1","#f4a582"))
#dev.off()
data<-read.table(args[2],sep="\t",header=T,stringsAsFactors = TRUE)
#svm_tune<-tune.svm(label~.,data=data,type="C-classification",kernel="radial",cost=c(0.1,1,5,10),gamma=c(0.5,1,2,3,4),scale=FALSE,probability=TRUE)
#summary(svm_tune)
#svm_model_after_tune<-svm_tune$best.model
svm_model_after_tune<-svm(label ~ ., data=data, type="C-classification", kernel="radial", cost=50, gmma=2, scale=FALSE,probability=TRUE)
temp<-paste(args[3],"svm_I_performance.pdf",sep ="_")
#pdf(temp)
#plot(svm_model_after_tune, data, Percent~Zscore)
grid <- expand.grid(seq(min(data[, 1]), max(data[, 1]),length.out=length(unique(data[,1]))), seq(min(data[, 2]), max(data[, 2]),length.out=length(unique(data[,1]))))
names(grid) <- names(data)[1:2]
preds <- predict(svm_model_after_tune, grid)
df <- data.frame(grid, preds)
#dev.off()
temp<-paste(args[3],"svm_line_I.txt",sep ="_")
write.table(df,temp,sep="\t")
temp<-paste(args[3],"svm_line_I.pdf",sep ="_")
#pdf(temp)
#ggplot(df, aes(x = Zscore, y = Percent)) + geom_tile(aes(fill=preds))+geom_jitter(data = data, aes(x=Zscore, y=Percent,colour=label), size = 0.2)+scale_colour_manual(values=c("#80cdc1","#f4a582"))
#dev.off()

